{% extends "base.html" %}

{% block title %}Carrito - Josbet{% endblock %}
{% block body_class %} class="form-page"{% endblock %}

{% block content %}
<main class="center-card wide">
  <h2>Mi Carrito</h2>
  
  {% if items %}
    <table style="width:100%;border-collapse:collapse;margin:1rem 0;">
      <thead>
        <tr style="border-bottom:2px solid #ff8fcf;">
          <th style="text-align:left;padding:0.5rem;">Producto</th>
          <th style="text-align:center;padding:0.5rem;">Cantidad</th>
          <th style="text-align:right;padding:0.5rem;">Precio</th>
          <th style="text-align:right;padding:0.5rem;">Subtotal</th>
          <th style="text-align:center;padding:0.5rem;">Acción</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
        <tr style="border-bottom:1px solid #ffd1e8;">
          <td style="padding:0.5rem;">{{ item.nombre }}</td>
          <td style="text-align:center;padding:0.5rem;">{{ item.cantidad }}</td>
          <td style="text-align:right;padding:0.5rem;">
            ${{ "%.2f"|format(item.precio) }}
          </td>
          <td style="text-align:right;padding:0.5rem;font-weight:bold;">
            ${{ "%.2f"|format(item.precio * item.cantidad) }}
          </td>
          <td style="text-align:center;padding:0.5rem;">

            <!-- POST a eliminar-carrito -->
            <form method="POST"
                  action="{{ url_for('eliminar_carrito', item_id=item.id) }}"
                  style="display:inline;">
              <button class="btn" type="submit"
                      style="padding:0.3rem 0.6rem;font-size:0.85rem;">
                Eliminar
              </button>
            </form>

          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    
    <h3 style="text-align:right;color:#ff8fcf;">
      Total: ${{ "%.2f"|format(total) }}
    </h3>
    
    <div class="btn-row">
      <a class="btn" href="{{ url_for('menu') }}">
        Continuar comprando
      </a>
      <a class="btn primary" href="{{ url_for('checkout') }}">
        Proceder al pago
      </a>
    </div>

  {% else %}
    <p style="text-align:center;color:#666;">
      El carrito está vacío
    </p>
    <div class="btn-row">
      <a class="btn primary" href="{{ url_for('menu') }}">
        Ver catálogo
      </a>
    </div>
  {% endif %}
  
  <p class="small" style="text-align:center;">
    <a href="{{ url_for('menu') }}">Volver al menú</a>
  </p>
</main>
{% endblock %}
